<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multi-Language Code Editor</title>
  <style>
    body {
      background-color: #000000;
      color: #ffffff;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0;
      margin: 0;
      height: 100vh;
      overflow: hidden;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    header {
      font-size: 2rem;
      margin: 20px 0 10px;
      color: #ffffff;
      user-select: none;
    }

    select {
      background-color: #000000;
      color: #ffffff;
      padding: 5px 10px;
      border: 1px solid #ffffff;
      border-radius: 5px;
      margin-bottom: 10px;
    }

    #editor {
      width: 90%;
      height: 50vh;
      border: 1px solid #ffffff;
      border-radius: 8px;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    .fullscreen #editor {
      position: fixed !important;
      top: 0;
      left: 0;
      width: 100vw !important;
      height: 100vh !important;
      border-radius: 0 !important;
      z-index: 9999;
    }

    .button-group {
      margin-top: 10px;
      user-select: none;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    button {
      background-color: #ffffff;
      color: #000000;
      border: none;
      padding: 10px 18px;
      border-radius: 5px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      white-space: nowrap;
    }

    button:hover {
      background-color: #e0e0e0;
    }

    #output-box {
      width: 90%;
      background-color: #222222;
      color: #ffffff;
      padding: 15px;
      margin-top: 20px;
      border-radius: 8px;
      white-space: pre-wrap;
      font-family: 'Courier New', Courier, monospace;
      max-height: 150px;
      overflow-y: auto;
    }

    .error {
      color: #ff4c4c;
    }

    .success {
      color: #00ff99;
    }

    .hidden {
      display: none;
    }

    /* White theme */
    body.white {
      background-color: #ffffff;
      color: #000000;
    }

    body.white header {
      color: #000000;
    }

    body.white select {
      background-color: #ffffff;
      color: #000000;
      border-color: #000000;
    }

    body.white #output-box {
      background-color: #eeeeee;
      color: #000000;
    }

    body.white button {
      background-color: #000000;
      color: #ffffff;
    }

    body.white button:hover {
      background-color: #222222;
    }

    body.white #editor {
      border-color: #000000;
    }
  </style>
</head>
<body>

  <header>Multi-Language Code Editor</header>
  <select id="languageSelect" aria-label="Select Programming Language">
    <option value="lua">Lua</option>
    <option value="javascript">JavaScript</option>
    <option value="python">Python</option>
    <option value="html">HTML</option>
    <option value="css">CSS</option>
  </select>

  <div id="editor" role="textbox" aria-multiline="true" aria-label="Code editor"></div>

  <div class="button-group">
    <button id="runBtn">Run Code</button>
    <button id="fullscreenBtn">Fullscreen</button>
    <button id="obfuscateBtn">Obfuscations</button>
    <button id="copyBtn">Copy Code</button>
    <button id="clearBtn">Clear Editor</button>
    <button id="downloadBtn">Download Code</button>
    <button id="themeToggleBtn">Toggle Theme</button>
  </div>

  <div id="output-box" role="region" aria-live="polite" aria-label="Output console">Console Output...</div>

  <!-- Ace Editor from CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-monokai.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-chrome.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-lua.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-javascript.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-python.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-html.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-css.js"></script>

  <script>
    const editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/lua");
    editor.setValue("-- Your Lua code here\n", 1);
    editor.setShowPrintMargin(false);

    const langSelect = document.getElementById("languageSelect");
    const outputBox = document.getElementById("output-box");
    const obfuscateBtn = document.getElementById("obfuscateBtn");
    const copyBtn = document.getElementById("copyBtn");
    const clearBtn = document.getElementById("clearBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const themeToggleBtn = document.getElementById("themeToggleBtn");
    const fullscreenBtn = document.getElementById("fullscreenBtn");
    const runBtn = document.getElementById("runBtn");

    function printOutput(text, type = '') {
      const escaped = text.replace(/[&<>"']/g, c => {
        return {'&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;'}[c];
      });
      outputBox.innerHTML = `<span class="${type}">${escaped}</span>`;
    }

    const languagePlaceholders = {
      lua: "-- Your Lua code here\n",
      javascript: "// Your JavaScript code here\n",
      python: "# Your Python code here\n",
      html: "<!-- Your HTML code here -->\n",
      css: "/* Your CSS code here */\n"
    };

    function saveCode() {
      const lang = langSelect.value;
      localStorage.setItem(`code_${lang}`, editor.getValue());
    }

    function loadCode() {
      const lang = langSelect.value;
      const saved = localStorage.getItem(`code_${lang}`);
      if (saved) editor.setValue(saved, 1);
      else editor.setValue(languagePlaceholders[lang], 1);
      printOutput(`Switched to ${lang.toUpperCase()} mode.`, 'success');
    }

    window.onload = () => {
      loadCode();
    };

    setInterval(saveCode, 10000);

    langSelect.addEventListener("change", () => {
      const lang = langSelect.value;
      editor.session.setMode("ace/mode/" + lang);
      loadCode();
    });

    runBtn.addEventListener("click", () => {
      const code = editor.getValue();
      const lang = langSelect.value;
      if (!code.trim()) return printOutput("No code to run.", 'error');

      switch (lang) {
        case "lua":
          printOutput("Run your Lua code in a Lua runtime or Roblox executor.", 'success');
          break;
        case "javascript":
          try {
            // Use Function constructor instead of eval for better scope control
            const result = new Function(code)();
            printOutput(result === undefined ? 'JavaScript ran successfully.' : String(result), 'success');
          } catch (e) {
            printOutput(`Error: ${e.message}`, 'error');
          }
          break;
        case "html":
          const win = window.open();
          if (!win) return printOutput("Popup blocked. Allow popups for this site.", "error");
          win.document.write(code);
          win.document.close();
          printOutput("HTML opened in new tab.", 'success');
          break;
        case "css":
          const styleWin = window.open();
          if (!styleWin) return printOutput("Popup blocked. Allow popups for this site.", "error");
          styleWin.document.write(`<style>${code}</style>`);
          styleWin.document.close();
          printOutput("CSS applied in new tab.", 'success');
          break;
        case "python":
          printOutput("Python runtime not supported here.", 'error');
          break;
      }
    });

    fullscreenBtn.addEventListener("click", () => {
      document.body.classList.toggle("fullscreen");
      setTimeout(() => editor.resize(), 100);
    });

    obfuscateBtn.addEventListener("click", () => {
      alert("This is TST's Obfuscator!");
      window.location.href = "https://luaobfuscations.netlify.app";
    });

    copyBtn.addEventListener("click", async () => {
      try {
        const text = editor.getValue();
        await navigator.clipboard.writeText(text);
        printOutput("Code copied to clipboard!", "success");
      } catch {
        printOutput("Failed to copy code. Try manually copying.", "error");
      }
    });

    clearBtn.addEventListener("click", () => {
      if (confirm("Are you sure you want to clear all the code?")) {
        editor.setValue("", 1);
        printOutput("Editor cleared.", "success");
      }
    });

    downloadBtn.addEventListener("click", () => {
      const lang = langSelect.value;
      const code = editor.getValue();
      const blob = new Blob([code], {type: "text/plain"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `code.${lang === "javascript" ? "js" : lang === "python" ? "py" : lang === "html" ? "html" : lang === "css" ? "css" : "lua"}`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      printOutput("Code downloaded.", "success");
    });

    themeToggleBtn.addEventListener("click", () => {
      if (document.body.classList.contains("white")) {
        document.body.classList.remove("white");
        editor.setTheme("ace/theme/monokai");
        printOutput("Switched to Black Theme.", "success");
      } else {
        document.body.classList.add("white");
        editor.setTheme("ace/theme/chrome");
        printOutput("Switched to White Theme.", "success");
      }
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SPortal FREE - Scripture Developer Portal</title>
<style>
  /* Reset & base */
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    background: #0f0f0f;
    color: #00ffcc;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  header {
    padding: 20px 15px;
    background: #111;
    color: #00ff99;
    font-weight: 700;
    font-size: 28px;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0, 255, 153, 0.3);
    user-select: none;
  }
  main {
    flex: 1;
    max-width: 900px;
    margin: 20px auto;
    width: 90%;
  }
  button {
    background-color: #00ff99;
    border: none;
    color: #000;
    font-weight: 700;
    font-size: 18px;
    padding: 14px 28px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.25s ease;
    margin: 8px;
    user-select: none;
  }
  button:hover, button:focus {
    background-color: #00cc7a;
    outline: none;
  }
  button:disabled {
    background-color: #555;
    cursor: not-allowed;
  }
  .portal {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
  }
  textarea, input[type=text] {
    width: 100%;
    padding: 14px 18px;
    border-radius: 8px;
    border: none;
    background-color: #1a1a1a;
    color: #00ffcc;
    font-family: monospace;
    font-size: 15px;
    box-shadow: 0 0 8px #00ffcc44 inset;
    resize: vertical;
    min-height: 160px;
  }
  input[readonly] {
    background-color: #121212;
    cursor: text;
    user-select: all;
  }
  label {
    display: block;
    margin-bottom: 6px;
    font-weight: 700;
    font-size: 16px;
    color: #00ff99;
  }
  .hidden {
    display: none;
  }
  .back-btn {
    background-color: #008855;
    color: #000;
    padding: 12px 24px;
    font-size: 16px;
    border-radius: 8px;
    cursor: pointer;
    margin-bottom: 25px;
    transition: background-color 0.25s ease;
    user-select: none;
  }
  .back-btn:hover, .back-btn:focus {
    background-color: #006644;
    outline: none;
  }
  .top-buttons {
    text-align: center;
    margin-bottom: 20px;
  }
  .top-buttons button {
    margin: 0 12px;
  }
  pre {
    background-color: #111;
    padding: 20px;
    border-radius: 8px;
    color: #00ffcc;
    font-family: monospace;
    font-size: 14px;
    white-space: pre-wrap;
    word-break: break-word;
    box-shadow: 0 0 8px #00ffcc44 inset;
    max-height: 400px;
    overflow-y: auto;
  }
  #moreToolsSection ul {
    list-style: none;
    padding-left: 0;
    max-width: 600px;
    margin: auto;
  }
  #moreToolsSection li {
    background: #141414;
    margin: 8px 0;
    padding: 14px 20px;
    border-radius: 8px;
    border-left: 5px solid #00ff99;
    box-shadow: 0 0 10px #00ffcc55;
    transition: background 0.3s;
  }
  #moreToolsSection li:hover {
    background: #1a1a1a;
  }
  #moreToolsSection a {
    color: #00ff99;
    text-decoration: none;
    font-weight: 600;
    font-size: 18px;
    display: block;
  }
  #moreToolsSection label {
    font-size: 26px;
    font-weight: 700;
    color: #00ff99;
    margin-bottom: 30px;
    text-align: center;
    letter-spacing: 2px;
  }
  .notes {
    margin: 15px auto 30px auto;
    max-width: 700px;
    font-style: italic;
    color: #80ffd3;
    background: #141414;
    padding: 12px 18px;
    border-radius: 8px;
    box-shadow: 0 0 10px #00ffcc44;
    text-align: center;
  }
  @media (max-width: 600px) {
    button {
      width: 100%;
      margin: 8px 0;
    }
  }
</style>
</head>
<body>
<header id="siteHeader">Scripture Developer Portal</header>

<main id="portalScreen" class="portal" aria-label="Main portal navigation">
  <button type="button" onclick="openSection('html')">HTML Site Creator</button>
  <button type="button" onclick="openSection('lua')">Lua Script Uploader</button>
  <button type="button" onclick="openSection('shortener')">Link Shortener</button>
  <button type="button" onclick="openSection('moreTools')">More Tools</button>
</main>

<main id="htmlSection" class="hidden" aria-label="HTML Site Creator Section">
  <button class="back-btn" type="button" onclick="goBack()">← Back</button>
  <label for="htmlCode">Paste your HTML code here:</label>
  <textarea id="htmlCode" placeholder="Paste your HTML code here..." spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off"></textarea>
  <button type="button" onclick="saveHTML()">Generate Site Link</button>
  <input type="text" id="htmlOutputLink" readonly placeholder="Your generated site link will appear here..." aria-readonly="true" />
</main>

<main id="luaSection" class="hidden" aria-label="Lua Script Uploader Section">
  <button class="back-btn" type="button" onclick="goBack()">← Back</button>
  <label for="luaCode">Input your Lua code here:</label>
  <textarea id="luaCode" placeholder="Input your Lua code here..." spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off"></textarea>
  <button type="button" onclick="saveLua()">Create Lua Script Link</button>
  <input type="text" id="luaOutputLink" readonly placeholder="Your Lua script link will appear here..." aria-readonly="true" />
</main>

<main id="shortenerSection" class="hidden" aria-label="Link Shortener Section">
  <button class="back-btn" type="button" onclick="goBack()">← Back</button>
  <label for="shortName">Custom short link name (optional):</label>
  <input type="text" id="shortName" placeholder="Enter custom link name (e.g. roblox_com)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
  <label for="redirectURL">Destination URL:</label>
  <input type="text" id="redirectURL" placeholder="Enter destination URL (e.g. https://roblox.com)" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
  <button type="button" onclick="saveShortLink()">Create Short Link</button>
  <input type="text" id="shortLinkOutput" readonly placeholder="Your short link will appear here..." aria-readonly="true" />
</main>

<main id="moreToolsSection" class="hidden" aria-label="More Tools Section">
  <button class="back-btn" type="button" onclick="goBack()">← Back</button>
  <label>More Tools</label>
  <ul>
    <li><a href="https://scriptsrblx.netlify.app/#html_jyvzuveg" target="_blank" rel="noopener noreferrer">Webhook Tools - Discord</a></li>
    <li><a href="https://scriptsrblx.netlify.app/#html_pkinznl2" target="_blank" rel="noopener noreferrer">IP Lookup - Universal</a></li>
  </ul>
</main>

<script>
  // LocalStorage keys
  const LUA_STORAGE_KEY = 'sharedLuaScripts';
  const SHORT_STORAGE_KEY = 'sharedShortLinks';

  // Get stored data or initialize empty objects
  const sharedLuaScripts = JSON.parse(localStorage.getItem(LUA_STORAGE_KEY)) || {};
  const sharedShortLinks = JSON.parse(localStorage.getItem(SHORT_STORAGE_KEY)) || {};

  function generateID(length = 8) {
    const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let id = '';
    for (let i = 0; i < length; i++) {
      id += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return id;
  }

  function openSection(section) {
    // Hide all sections first
    ['portalScreen', 'htmlSection', 'luaSection', 'shortenerSection', 'moreToolsSection'].forEach(id => {
      document.getElementById(id).classList.add('hidden');
    });
    // Show selected
    document.getElementById(section + 'Section').classList.remove('hidden');

    // Change header text accordingly
    const headerTexts = {
      html: 'HTML Site Creator',
      lua: 'Lua Script Uploader',
      shortener: 'Link Shortener',
      moreTools: 'More Tools',
    };
    document.getElementById('siteHeader').textContent = headerTexts[section] || 'Scripture Developer Portal';

    // Clear outputs on open
    if(section === 'html') document.getElementById('htmlOutputLink').value = '';
    if(section === 'lua') document.getElementById('luaOutputLink').value = '';
    if(section === 'shortener') {
      document.getElementById('shortLinkOutput').value = '';
      document.getElementById('shortName').value = '';
      document.getElementById('redirectURL').value = '';
    }
  }

  function goBack() {
    // Hide all sections except portalScreen
    ['htmlSection', 'luaSection', 'shortenerSection', 'moreToolsSection'].forEach(id => {
      document.getElementById(id).classList.add('hidden');
    });
    document.getElementById('portalScreen').classList.remove('hidden');
    document.getElementById('siteHeader').textContent = "Scripture Developer Portal";
  }

  function sanitizeName(name) {
    return name.replace(/[^a-zA-Z0-9_-]/g, "_");
  }

  // Save HTML: encode entire code in URL hash as base64
  function saveHTML() {
    const code = document.getElementById('htmlCode').value.trim();
    if (!code) return alert("Please enter some HTML code.");

    try {
      const encoded = btoa(unescape(encodeURIComponent(code)));
      const link = location.origin + location.pathname + "#code=" + encoded;
      document.getElementById('htmlOutputLink').value = link;
    } catch(e) {
      alert("Failed to encode the HTML code.");
    }
  }

  // Save Lua script in localStorage and generate link
  function saveLua() {
    const code = document.getElementById('luaCode').value.trim();
    if (!code) return alert("Please enter Lua code.");

    const id = generateID();
    sharedLuaScripts[id] = code;
    localStorage.setItem(LUA_STORAGE_KEY, JSON.stringify(sharedLuaScripts));

    const link = location.origin + location.pathname + "#lua_" + id;
    document.getElementById('luaOutputLink').value = link;
  }

  // Save short link in localStorage and generate short link URL
  function saveShortLink() {
    let name = document.getElementById('shortName').value.trim();
    const url = document.getElementById('redirectURL').value.trim();

    if (!url) return alert("Please enter a destination URL.");

    if (!name) name = generateID();
    name = sanitizeName(name);

    sharedShortLinks[name] = url;
    localStorage.setItem(SHORT_STORAGE_KEY, JSON.stringify(sharedShortLinks));

    const shortLink = location.origin + location.pathname + "#short_" + name;
    document.getElementById('shortLinkOutput').value = shortLink;
  }

  // On page load: parse URL hash and show correct content
  window.addEventListener('load', () => {
    const hash = location.hash;

    if (hash.startsWith("#code=")) {
      // HTML code display: decode base64 and write page
      const encoded = hash.slice(6);
      try {
        const decoded = decodeURIComponent(escape(atob(encoded)));
        document.open();
        document.write(decoded);
        document.close();
      } catch (e) {
        document.body.innerHTML = "<h2 style='color:red;text-align:center;margin-top:50px;'>Invalid or corrupted code.</h2>";
      }
    } else if (hash.startsWith("#lua_")) {
      // Show Lua script viewer with copy & download
      const id = hash.slice(5);
      const code = sharedLuaScripts[id];
      if (code) {
        document.body.innerHTML = `
          <header style="background:#111;padding:15px;color:#0f0;font-weight:bold;text-align:center;">Lua Script Viewer</header>
          <div style="max-width:900px;margin:30px auto; padding:20px; background:#141414; border-radius:10px; box-shadow: 0 0 10px #00ffcc55; color:#00ffcc; font-family: monospace; font-size: 14px; white-space: pre-wrap; word-break: break-word;">
            <div style="text-align:center; margin-bottom: 20px;">
              <button onclick="copyLua()" style="margin-right: 12px; padding: 10px 20px; font-size:16px; font-weight:bold; cursor:pointer; border:none; border-radius:8px; background:#00ff99; color:#000;">Copy Script</button>
              <button onclick="downloadLua()" style="padding: 10px 20px; font-size:16px; font-weight:bold; cursor:pointer; border:none; border-radius:8px; background:#00ff99; color:#000;">Download Script</button>
            </div>
            <pre id="luaDisplay">${escapeHtml(code)}</pre>
          </div>
          <script>
            function copyLua() {
              const code = document.getElementById("luaDisplay").textContent;
              navigator.clipboard.writeText(code).then(() => alert("Script copied to clipboard!"));
            }
            function downloadLua() {
              const code = document.getElementById("luaDisplay").textContent;
              const blob = new Blob([code], {type: "text/plain"});
              const a = document.createElement("a");
              a.href = URL.createObjectURL(blob);
              a.download = "script.lua";
              a.click();
              URL.revokeObjectURL(a.href);
            }
          <\/script>
        `;
      } else {
        document.body.innerHTML = "<h2 style='color:red;text-align:center;margin-top:50px;'>404 - Lua Script Not Found (maybe expired on page reload)</h2>";
      }
    } else if (hash.startsWith("#short_")) {
      // Redirect short link
      const name = hash.slice(7);
      const url = sharedShortLinks[name];
      if (url) {
        window.location.replace(url);
      } else {
        document.body.innerHTML = "<h2 style='color:red;text-align:center;margin-top:50px;'>404 - Short Link Not Found (maybe expired on page reload)</h2>";
      }
    }
  });

  // Utility: escape HTML entities for display
  function escapeHtml(text) {
    return text.replace(/[&<>"']/g, function (m) {
      switch (m) {
        case '&': return '&amp;';
        case '<': return '&lt;';
        case '>': return '&gt;';
        case '"': return '&quot;';
        case "'": return '&#39;';
        default: return m;
      }
    });
  }
</script>
</body>
</html>
